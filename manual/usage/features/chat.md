# 聊天控制系统说明

## 概述

这是麦麦回复的主要逻辑，负责决定何时回复以及使用动作。
能够根据聊天内容、用户兴趣、时间等因素动态调整回复策略。

## 系统架构

### 运行流程

```
启动聊天循环 → 检查新消息 → 计算兴趣值 → 决定是否回复 → 规划动作 → 执行动作 → 更新状态
```

## 常见问题及解决方案

### 1. 为什么不说话/说话很少？

#### 可能原因：


   - 新消息数量不足
   - 累计兴趣值过低
   - 聊天频率设置过低
   - 当前时间段专注度配置较低，麦麦不会进行进一步思考

#### 解决方案：

在配置文件中调整talk_frequency或者focus_value
   - talk_frequency：思考的频率
   - focus_value：深入思考的程度

```toml
[chat]
# 提高聊天频率，提高回复概率
talk_frequency = 0.8

# 提高专注度，增加回复可能性
focus_value = 0.9

# 或对时间段配置进行修改
focus_value_adjust = [
    ["", "8:00,1", "12:00,0.8", "18:00,1", "01:00,0.3"],
    ["qq:114514:group", "12:20,0.6", "16:10,0.5", "20:10,0.8", "00:10,0.3"],
    ["qq:1919810:private", "8:20,0.5", "12:10,0.8", "20:10,1", "00:10,0.2"]
]

talk_frequency_adjust = [
    ["", "8:00,0.5", "12:00,0.6", "18:00,0.8", "01:00,0.3"],
    ["qq:114514:group", "12:20,0.3", "16:10,0.5", "20:10,0.4", "00:10,0.1"],
    ["qq:1919810:private", "8:20,0.3", "12:10,0.4", "20:10,0.5", "00:10,0.1"]
]
# 基于聊天流的个性化活跃度和专注度配置
# 格式：[["platform:chat_id:type", "HH:MM,frequency", "HH:MM,frequency", ...], ...]

# 全局配置示例：
# [["", "8:00,1", "12:00,2", "18:00,1.5", "00:00,0.5"]]

# 特定聊天流配置示例：
# [
#     ["", "8:00,1", "12:00,1.2", "18:00,1.5", "01:00,0.6"],  # 全局默认配置
#     ["qq:1026294844:group", "12:20,1", "16:10,2", "20:10,1", "00:10,0.3"],  # 特定群聊配置
#     ["qq:729957033:private", "8:20,1", "12:10,2", "20:10,1.5", "00:10,0.2"]  # 特定私聊配置
# ]

# 说明：
# - 当第一个元素为空字符串""时，表示全局默认配置
# - 当第一个元素为"platform:id:type"格式时，表示特定聊天流配置
# - 后续元素是"时间,频率"格式，表示从该时间开始使用该活跃度，直到下一个时间点
# - 优先级：特定聊天流配置 > 全局配置 > 默认 talk_frequency
```

## 配置建议

### 高活跃度配置

```toml
[chat]
talk_frequency = 0.8
focus_value = 0.9
```

### 低活跃度配置

```toml
[chat]
talk_frequency = 0.4
focus_value = 0.2
```
